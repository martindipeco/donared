<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>DonaRed</title>
  </head>
  <body>
    <p>{% if editing %}Editar donación{% else %}Publicar una donacion{% endif %}</p>
    <!-- Added enctype="multipart/form-data" to support file uploads -->
     <!-- Conditional form action based on whether we're editing or creating -->
    {% if editing %}
    <form action="{% url 'donaredapp:actualizar_item' item_id=item.id %}" method="post" enctype="multipart/form-data">
    {% else %}
    <form action="{% url 'donaredapp:publicar' %}" method="post" enctype="multipart/form-data">
    {% endif %}
    {% csrf_token %}
        <fieldset>  
            <label for="nombre">Nombre:</label>
            <!-- Use item.nombre only if editing and item exists -->
            <input type="text" id="nombre" name="nombre" 
            value="{% if editing %}{{ item.nombre }}{% endif %}" required><br><br>
            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" required>{% if editing %}{{ item.descripcion }}{% endif %}</textarea><br><br>
            <label for="zona">Zona:</label>
            <select id="zona" name="zona" required>
                <option value="" disabled {% if not editing or not item.zona %}selected{% endif %}>Seleccione...</option>
                {% for zona in zonas %}
                    <option value="{{ zona.id }}">{{ zona }}</option>
                {% endfor %}
            </select><br><br>
            <label for="categoria">Categoria:</label>
            <select id="categoria" name="categoria" required>
                <option value="" disabled {% if not editing or not item.categoria %}selected{% endif %}>Seleccione... </option>
                {% for categoria in categorias %}
                    <option value="{{ categoria.id }}">{{ categoria }}</option>
                {% endfor %}
            </select><br><br>
            <!-- Add the image upload field -->
            <label for="imagen">Imagen: (máximo 2 mb)</label>
            {% if editing and item.imagen %}
            <p>Imagen actual: {{ item.imagen.name }}</p>
            <label><input type="checkbox" name="mantener_imagen" checked> Mantener imagen actual</label><br>
            {% endif %}
            <input type="file" id="imagen" name="imagen" accept="image/*"><br><br>
        </fieldset>
        <input type="submit" value="{% if editing %}Actualizar{% else %}Publicar{% endif %}">
    </form>
    <!-- JavaScript para controlar el tamaño máximo de archivo, del lado del cliente -->
    <!-- A reemplzar según consideración equipo Front -->
    <script>
      document.getElementById('imagen').addEventListener('change', function() {
          const file = this.files[0];
          const maxSize = 2 * 1024 * 1024; // 2 MB in bytes
          
          if (file && file.size > maxSize) {
              alert('La imagen no debe exceder {{ MAX_IMAGE_SIZE_MB }}MB');
              this.value = ''; // Clear the input
          }
      });
      </script>
  </body>
</html>