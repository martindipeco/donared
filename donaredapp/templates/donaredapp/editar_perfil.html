{% extends 'donaredapp/base.html' %}

{% block title %}Editar Perfil - DonaredApp{% endblock %}

{% block content %}
<section class="bodyLogin">
    <main id="main-login" class="main-login">
        
        <!-- Messages display -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h2>Editar Perfil</h2>
                    </div>
                    <div class="card-body">
                        <!-- Profile Information Form -->
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="change_profile" value="1">
                            
                            <!-- User basic information -->
                            <div class="form-group mb-3">
                                <label for="id_username">Nombre de usuario:</label>
                                {{ user_form.username }}
                                {% if user_form.username.errors %}
                                    <div class="alert alert-danger mt-1">{{ user_form.username.errors }}</div>
                                {% endif %}
                                {% if user_form.username.help_text %}
                                    <small class="form-text text-muted">{{ user_form.username.help_text }}</small>
                                {% endif %}
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="id_email">Email:</label>
                                {{ user_form.email }}
                                {% if user_form.email.errors %}
                                    <div class="alert alert-danger mt-1">{{ user_form.email.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="id_first_name">Nombre:</label>
                                {{ user_form.first_name }}
                                {% if user_form.first_name.errors %}
                                    <div class="alert alert-danger mt-1">{{ user_form.first_name.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="id_last_name">Apellido:</label>
                                {{ user_form.last_name }}
                                {% if user_form.last_name.errors %}
                                    <div class="alert alert-danger mt-1">{{ user_form.last_name.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- Profile additional fields -->
                            {% if profile_form %}
                                <hr>
                                <h4>Información adicional</h4>
                                
                                <div class="form-group mb-3">
                                    <label for="id_movil">Número de móvil (opcional):</label>
                                    {{ profile_form.movil }}
                                    {% if profile_form.movil.errors %}
                                        <div class="alert alert-danger mt-1">{{ profile_form.movil.errors }}</div>
                                    {% endif %}
                                    {% if profile_form.movil.help_text %}
                                        <small class="form-text text-muted">{{ profile_form.movil.help_text }}</small>
                                    {% endif %}
                                </div>
                                
                                <div class="form-group mb-3">
                                    <label for="id_validado">Validación:</label>
                                    <div class="form-check">
                                        {{ profile_form.validado }}
                                        <label class="form-check-label" for="id_validado">
                                            {{ profile_form.validado.label }}
                                        </label>
                                    </div>
                                    {% if profile_form.validado.errors %}
                                        <div class="alert alert-danger mt-1">{{ profile_form.validado.errors }}</div>
                                    {% endif %}
                                    {% if profile_form.validado.help_text %}
                                        <small class="form-text text-muted">{{ profile_form.validado.help_text }}</small>
                                    {% endif %}
                                </div>
                            {% endif %}
                            
                            <div class="d-flex gap-2 mt-4">
                                <button type="submit" name="change_profile" class="btn btn-primary">Guardar cambios</button>
                                <a href="{% url 'donaredapp:perfil' %}" class="btn btn-secondary">Cancelar</a>
                            </div>
                        </form>
                        
                        <!-- Password Change Section -->
                        <hr class="my-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning bg-opacity-10">
                                <h4 class="mb-0">Cambiar Contraseña</h4>
                            </div>
                            <div class="card-body">
                                <form method="post">
                                    {% csrf_token %}
                                    
                                    <div class="form-group mb-3">
                                        <label for="id_old_password">Contraseña actual:</label>
                                        {{ password_form.old_password }}
                                        {% if password_form.old_password.errors %}
                                            <div class="alert alert-danger mt-1">{{ password_form.old_password.errors }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        <label for="id_new_password1">Nueva contraseña:</label>
                                        {{ password_form.new_password1 }}
                                        {% if password_form.new_password1.errors %}
                                            <div class="alert alert-danger mt-1">{{ password_form.new_password1.errors }}</div>
                                        {% endif %}
                                        {% if password_form.new_password1.help_text %}
                                            <small class="form-text text-muted">{{ password_form.new_password1.help_text }}</small>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        <label for="id_new_password2">Confirmar nueva contraseña:</label>
                                        {{ password_form.new_password2 }}
                                        {% if password_form.new_password2.errors %}
                                            <div class="alert alert-danger mt-1">{{ password_form.new_password2.errors }}</div>
                                        {% endif %}
                                    </div>
                                    <input class="boton" type="submit" name="change_password" value="Iniciar Sesión">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </main>
</section>
{% endblock %}